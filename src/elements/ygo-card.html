<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../helpers/shared-styles.html">

<link rel="import" href="ygo-card-img.html">

<dom-module id="ygo-card">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 0px;
      }
      paper-icon-button {
        display: inline-block;
        vertical-align: middle;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        padding: 0px;
      }
      .count {
        vertical-align: middle;
        display: inline-block;
        width: 30%;
      }
      #name {
        vertical-align: middle;
        display: inline-block;
        text-align: center;
        width: 36%;
      }
      .clear {
        vertical-align: middle;
        display: inline-block;
        width: 30%;
      }
      .inline {
        display: inline-block;
      }
      .right-algin {
        text-align: right;
      }
      paper-dropdown-menu {
        display: inline-block;
        margin-left: 5px;
        margin-right: auto;
        width: 33px;
      }
      .card {
        margin-top: 7.5px;
        margin-bottom: 7.5px;
        margin-left: 10px;
        margin-right: 10px;
        padding-top: 0px;
        padding-bottom: 0px;
        padding-left: 7.5px;
        padding-right: 7.5px;
      }
    </style>

    <div class="card" id="card">
        <div class="count">
          <paper-icon-button disabled id="removeCard" icon="remove" on-tap="minusOne"></paper-icon-button>
          <p class="inline">[[count]]</p>
          <paper-icon-button id="addCard" icon="add" on-tap="plusOne"></paper-icon-button>
        </div>
        <div id="name">
          <h4 class="inline">[[name]]</h4>        
        </div>
        <div class="clear">
          <div class="right-algin">
            <ygo-card-img card="[[card]]" height="32px" width="24px"></ygo-card-img>
            <paper-icon-button icon="clear" on-tap="clearCard"></paper-icon-button>
          </div>
        </div>
    </div>
  </template>

  <script>
    class YGOCard extends Polymer.Element {
      static get is() { return 'ygo-card'; }
      
      ready(){
        super.ready();
        this.name = this.card.name;
        this.$.name.setAttribute('style', 'color: '+ this.color);
        document.addEventListener(this.deck + '-update-count-' + this.name, e => this.updateCount(e));
      }

      updateCount(e) {
        this.count = e.detail.count;
        if (this.count == 3) Polymer.dom( this.$.addCard ).setAttribute('disabled','');
        if (this.count > 1) Polymer.dom( this.$.removeCard ).removeAttribute('disabled');
      }

      minusOne(e) {
        if (this.count > 1) {
          this.count--;
          document.dispatchEvent(new CustomEvent('remove-card', {detail: {card: this}}));
          if (this.count == 1) this.$.removeCard.setAttribute('disabled','');
          if (this.count < 3) this.$.addCard.removeAttribute('disabled');
        }
      }

      plusOne(e) {
        if (this.count < 3) {
          this.count++;
          document.dispatchEvent(new CustomEvent('create-card', {detail: {card: this.name, deck: this.deck}}));
          if (this.count == 3) Polymer.dom( this.$.addCard ).setAttribute('disabled','');
          if (this.count > 1) Polymer.dom( this.$.removeCard ).removeAttribute('disabled');
        }
      }

      clearCard(e) {
        document.dispatchEvent(new CustomEvent('clear-card-from-' + this.deck, {detail: {card: this}}));
      }

      static get properties() {
        return {
          card: {
            type: Object,
            value: function() { return {} }
          },
          name: {
            type: String,
            value: 'Unknown Card'
          },
          count: {
            type: Number,
            value: '1'
          },
          deck: {
            type: String,
            value: 'main'
          }
        };
      }
    }
    window.customElements.define(YGOCard.is, YGOCard);
  </script>
</dom-module>