<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../helpers/shared-styles.html">

<dom-module id="ygo-card">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 0px;
      }
      paper-icon-button {
        display: inline-block;
        vertical-align: middle;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        padding: 0px;
      }
      .clear {
        display: inline-block;
        width: 25%;;
      }
      h4 {
        display: inline-block;
        text-align: center;
        width: 47%;
      }
      p {
        display: inline-block;
      }
      .count {
        display: inline-block;
        width: 25%;
      }
      .right-algin {
        text-align: right;
      }
      
      paper-dropdown-menu {
        display: inline-block;
        margin-left: 5px;
        margin-right: auto;
        width: 33px;
      }
      .card {
        margin-top: 7.5px;
        margin-bottom: 7.5px;
        margin-left: 10px;
        margin-right: 10px;
        padding-top: 0px;
        padding-bottom: 0px;
        padding-left: 7.5px;
        padding-right: 7.5px;
      }
    </style>

    <div class="card" id="card">
        <div class="clear">
          <paper-icon-button icon="clear" on-tap="clearCard"></paper-icon-button>
        </div>
        <h4>[[name]]</h4>
        <div class="count">
          <div class="right-algin">
            <paper-icon-button disabled id="removeCard" icon="remove" on-tap="minusOne"></paper-icon-button>
            <p>[[count]]</p>
            <paper-icon-button id="addCard" icon="add" on-tap="plusOne"></paper-icon-button>
          </div>
        </div>
    </div>
  </template>

  <script>
    class YGOCard extends Polymer.Element {
      static get is() { return 'ygo-card'; }
      
      ready(){
        super.ready();
        document.addEventListener(this.deck + '-update-count-' + this.name, e => this.updateCount(e));
        switch (this.type) {
          case "Normal":   this.color = "#FDD835"; break;
          case "Effect":   this.color = "#FF8F00"; break;
          case "Ritual":   this.color = "#039BE5"; break; 
          case "Fusion":   this.color = "#9C27B0"; break;
          case "Synchro":  this.color = "#FFFFFF"; break;
          case "Xyz":      this.color = "#263238"; break;
          case "Pendulum": this.color = "#43A047"; break;
          case "Link":     this.color = "#0277BD"; break;
          case "Spell":    this.color = "#4CAF50"; break;
          case "Trap":     this.color = "#D81B60"; break;
        }
        var textColor = this.type == "Synchro" ? "#000000" : "#ffffff"; 
        this.$.card.setAttribute('style', 'color: '+ textColor + '; background-color: '+ this.color);
      }

      updateCount(e) {
        this.count = e.detail.count;
        if (this.count == 3) Polymer.dom( this.$.addCard ).setAttribute('disabled','');
        if (this.count > 1) Polymer.dom( this.$.removeCard ).removeAttribute('disabled');
      }

      minusOne(e) {
        if (this.count > 1) {
          this.count--;
          document.dispatchEvent(new CustomEvent('remove-card', {detail: {card: this}}));
          if (this.count == 1) this.$.removeCard.setAttribute('disabled','');
          if (this.count < 3) this.$.addCard.removeAttribute('disabled');
        }
      }

      plusOne(e) {
        if (this.count < 3) {
          this.count++;
          document.dispatchEvent(new CustomEvent('create-card', {detail: {card: this.name, deck: this.deck}}));
          if (this.count == 3) Polymer.dom( this.$.addCard ).setAttribute('disabled','');
          if (this.count > 1) Polymer.dom( this.$.removeCard ).removeAttribute('disabled');
        }
      }

      clearCard(e) {
        document.dispatchEvent(new CustomEvent('clear-card-from-' + this.deck, {detail: {card: this}}));
      }

      static get properties() {
        return {
          name: {
            type: String,
            value: 'Unknown Card'
          },
          count: {
            type: Number,
            value: '1'
          },
          color: {
            type: String,
            value: '#fff'
          },
          deck: {
            type: String,
            value: 'main'
          },
          type: {
            type: String,
            value: 'Unknown'
          }
        };
      }
    }
    window.customElements.define(YGOCard.is, YGOCard);
  </script>
</dom-module>